<html>
<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="menu.css"/>
      <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
      <script src="//code.jquery.com/jquery-1.10.2.js"></script>
      <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
</head>

<body onload="openClient('keywords');">
    <div>
        <span id="close-icon"  title="Close window"> </span>
    </div>
    <div class="contentpanel">
    <br>
        <ul class="tab">
          <li><a href="#" id='keywords-link' class="tablinks" onclick="openTab(event, 'keywords')">Search by keywords</a></li>
          <li><a href="#" id='usual-link' class="tablinks" onclick="openTab(event, 'usual')">Search in files</a></li>
        </ul>

        <div class="searchbar">

            <label>Please, type info for search</label>
            <div id="keywords" class="tabcontent">
                <table id="resume-keys">
                </table>
                <center><span id="add-clause" src="./icon/add.png" title="Add clause" onClick="addRow();"></span></center>
                <hr>
            </div>

            <div id="usual" class="tabcontent">
                <input type="text" id="edit-box">
                <input type="checkbox" id="find-strict"/>
                <label for='find-strict'><span></span>find this text strict</label>
                <label>Please, type dirpath for search</label>
                <input type="text" id="finding-dir"/>
            </div>

            <table>
                <tr>
                    <td colspan='2'>
                        <button id="find">Find</button>
                    </td>
                    <td colspan='2'>
                        FOUNDED:&nbsp;&nbsp;<label id='res-count'></label>
                    </td>
                </tr>
            </table>
            <div id="result-list">
    <label><h3>Here will be search result... Just try to find something, baby!</h3></label></div>
        </div>
    <center><button id="close-btn">Close</button></center>

    </div>

</body>

<!--<script>

    var tableContent = {
        'Должность': { 'element': 'input', 'params': { 'name': 'profession', 'type': 'text' } },
        'Фио': { 'element': 'input', 'params': { 'name': 'name', 'type': 'text' } },
        'Дата рождения': { 'element': 'input', 'params': { 'name': 'birthday', 'type': 'text' } },
        'Места работы': { 'element': 'textarea', 'params': { 'name': 'work_history' } },
        'Зарплатные ожидания': { 'element': 'input', 'params': { 'name': 'payment', 'type': 'text' } },
        'Ключевые навыки': { 'element': 'textarea', 'params': { 'name': 'achievements' } },
        'Общая информация': { 'element': 'textarea', 'params': { 'name': 'additional_info' } },
        'Знание языков': { 'element': 'input', 'params': { 'name': 'languages', 'type': 'text' } }
    };
var textArea = document.getElementById("result-list");
var resultArea = document.getElementById("result");
var findText = document.getElementById("edit-box");
var dir = document.getElementById("finding-dir");
var lbl = document.getElementById('res-count');
var keywordPane = document.getElementById('keywords-link');
var usualPane = document.getElementById('usual-link');
var isStrict = document.getElementById('find-strict');
var findBtn = document.getElementById("find");
var keywordsTable = document.getElementById("resume-keys");
var addClauseImage = document.getElementById("add-clause");


keywordPane.addEventListener('click', function(evt) { openTab(evt, 'keywords'); }, false);
usualPane.addEventListener('click', function(evt) { openTab(evt, 'usual'); }, false);
document.getElementById('keywords-link').click();
// make eventlisteners. they will send info for finding
findBtn.addEventListener('click', submit, false);
/*document.addEventListener('keyup', function(event) {
    if (event.keyCode == 13)
        submit();
}, false);*/

addRow();

function submit() {
    var data;
    var isKeyword = (keywordPane.className.indexOf('active') != -1);
    var strictFind = isStrict.checked && (keywordPane.className.indexOf('active') == -1);
    console.log('isKeyword',isKeyword,'strictFind',strictFind);
    var text = keywordPane.className.indexOf('active') == -1 ? findText.value : getKeywords();
    if (dir.value.length > 0 || isKeyword) {
        data = {
            'text': text,
            'dir': dir.value,
            'strictFind': strictFind,
            'keyword': isKeyword
        }
        self.port.emit("text-entered", JSON.stringify(data));
    }
    console.log('data',data);
}

function getKeywords() {
    var result = {};
    var selectCat = keywordsTable.getElementsByClassName('select-categories');
    var selectOper = keywordsTable.getElementsByClassName('select-operations');
    var inputArr = keywordsTable.getElementsByTagName('INPUT');


    for (var i = 0; i < selectCat.length; i++) {
        if (result[selectCat[i].value] == undefined)
            result[selectCat[i].value] = [];
        var info = {'operand': 'LIKE', 'value': ''};
        for (var j = 0; j < selectOper.length; j++) {
            if (selectCat[i].name == selectOper[j].name) {
                info['operand'] = selectOper[j].value;
            }
        }
        for (var j = 0; j < inputArr.length; j++) {
            if (selectCat[i].name == inputArr[j].name) {
                if (selectCat[i].value.toLowerCase().indexOf('дата') != -1) {
                    //var from = "10-11-2011"; 
                    //var numbers = inputArr[j].value.match(/\d+/g); 
                    //var date = new Date(numbers[2], numbers[0]-1, numbers[1]);
                    info['value'] = inputArr[j].value;
                    break;
                }
                info['value'] = inputArr[j].value;
            }
        }
        result[selectCat[i].value].push(info);
    }
    console.log('getKeywords', result);
    return result;
}

function keywordsOnchange() {
    if (isKeyword.checked) {
        isStrict.checked = '';
        isStrict.disabled = true;
    } else {
        isStrict.disabled = false;
    }
}

function deleteRow(event) {
    var tr = event.target;
    while (tr.tagName != 'TR') {
        tr = tr.parentElement;
    }
    tr.remove();
}

function onSelectChange(e) {
    var rowIndividualName = e.target.name;
    console.log(rowIndividualName);
    var arr = document.getElementsByName(rowIndividualName);
    var input, operand;
    for (var i = 0; i < arr.length; i++){
        if (arr[i].tagName == 'INPUT')
            input = arr[i];
        if (arr[i].className == 'select-operations')
            operand = arr[i];
    }
    while (operand.children.length > 0) {
        operand.remove(0);
    }
    var list = ['=','>','<','<>','>=','<='];
    if (e.target.value.toLowerCase().indexOf('дата') != -1) {
        input.placeholder = 'ГГГГ.ММ.ДД';
        for (var i = 0; i < list.length; i++){
            var option = document.createElement("option");
            option.value = list[i];
            option.text = list[i];
            operand.appendChild(option);
        }
        return;
    }
    if (e.target.value.toLowerCase().indexOf('зарплат') != -1) {
        for (var i = 0; i < list.length; i++){
            var option = document.createElement("option");
            option.value = list[i];
            option.text = list[i];
            operand.appendChild(option);
        }
        return;
    }
    
    list = ['LIKE','=','<>'];
    for (var i = 0; i < list.length; i++){
        var option = document.createElement("option");
        option.value = list[i];
        option.text = list[i];
        operand.appendChild(option);
    }
}

function addRow() {
    var tr = document.createElement('tr');
    keywordsTable.appendChild(tr);
    var rowIndividualName = (new Date()).toTimeString();
    var td = document.createElement('td');
    var selectList = document.createElement('select');
    for (var i in tableContent){
        var option = document.createElement("option");
        option.value = i;
        option.text = i;
        selectList.appendChild(option);
    }
    var option = document.createElement("option");
    option.value = 'all_cat';
    option.text = 'По всем категориям';
    selectList.appendChild(option);
    selectList.name = rowIndividualName;
    selectList.setAttribute('class','select-categories');
    selectList.addEventListener('change', onSelectChange, false);
    td.appendChild(selectList);
    td.setAttribute('style', 'width: 100px;');
    tr.appendChild(td);

    var td1 = document.createElement('td');
    var list = ['LIKE','=','<>'];
    var selectOperand = document.createElement('select');
    selectOperand.name = rowIndividualName;
    selectOperand.setAttribute('class','select-operations');
    for (var i = 0;i< list.length; i++){
        var option = document.createElement("option");
        option.value = list[i];
        option.text = list[i];
        selectOperand.appendChild(option);
    }
    selectOperand.setAttribute('style', 'width: 60px;');
    td1.appendChild(selectOperand);
    tr.appendChild(td1);

    var elem = document.createElement('input');
    elem.type = 'text';
    elem.name = rowIndividualName;

    var td2 = document.createElement('td');
    tr.appendChild(td2);
    td2.appendChild(elem);

    var td3 = document.createElement('td');
    td3.setAttribute('style', 'width: 30px;');
    tr.appendChild(td3);
    var closeImage = document.createElement('img');
    closeImage.src = './icon/delete.png';
    closeImage.title = "Delete this clause";
    closeImage.addEventListener('click', deleteRow, false);
    td3.appendChild(closeImage);
}

self.port.on("show", function onShow() {
    dir.value = localStorage.getItem('webpages-dir');
});

self.port.on('bad-dir', function() {
    alert('Invalid dir for find!');
});

self.port.on('good-dir', function(text) {
    localStorage.setItem('webpages-dir', text);
    dir.value = text;
});

function setInfo(text, count) {
    textArea.value = text;
    lbl.innerHTML = count;
}
// find is over. we will put result in textarea
self.port.on("end-of-find", function(text) {
    setInfo(JSON.parse(text)['result'], JSON.parse(text)['count']);
});

function openClient(tabname) {
    try {
        document.getElementById(tabname + '-link').click();
    } catch(e) {

    }
}

function openTab(evt, tabName) {
    console.log('openTab',evt, tabName);
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tabcontent.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the link that opened the tab
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
    setInfo('', 0);
}
</script>-->
</html>